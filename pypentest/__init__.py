import requests as req
import pandas as pd
import os
import json



def extraer_cabeceras(url):
    print("")
    print(f"Examinando url {url}...")
    req_headers = req.get(url)

    dict_headers = req_headers.headers.__dict__['_store']
    json_headers = json.dumps(dict_headers)
    print('Headers = ',json_headers)

    keys = list(key.lower() for key in dict_headers.keys())
    print("")
    print("Evaluate headers")
    print("=================================")
    print("\tContent-security-policy ", end="")
    if "content-security-policy" in keys:
        print("✅")
    else:
       print("❌")

    print("")

if __name__ == '__main__':
    #print(os.getcwd())
    fichero = pd.read_csv("pypentest/urls-pentest.csv")

    for index, row in fichero.iterrows():
        url = row["url"]
        extraer_cabeceras(url)